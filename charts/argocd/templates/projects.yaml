{{- range $project := .Values.projects }}
---
kind: AppProject
apiVersion: argoproj.io/v1alpha1
metadata:
  name: {{ $project.name }}
  labels:
    {{- include "argocd.labels" $ | nindent 4 }}
spec: # doesn't render correctly when neither object below is set
  description: {{ $project.description }}
  {{- if $project.destinations }}
  destinations:
    {{- toYaml $project.destinations | nindent 4 }}
  {{- end }}
{{- end }}
